import{o as _,u as P,r as l,S as V,a as z,b as F,c as q,d as U,e as w,g as b,f as J,s as K,j as e,M as Q,C as R,h as B,W as X,E as Y,B as i,T as Z,i as H,D as ee,k as se,G as I,l as ae,m as te,t as ne,n as oe,p as re,q as le,v as ie,w as ce,x as de,I as xe,F as pe,y as ue,z as he,A as fe,H as m,J as W,K as me,L as ye,N as ge,O as je,P as Ce,Q as be}from"./index-Zl2zfVU-.js";function k(a,n){const r=ve(a);return n(r),we(r)}function ve(a){return Object.fromEntries(a.map(n=>[n,{total:0,current:0}]))}function we(a){return _(a,({total:n,current:r})=>r===n?`${n}`:`${r}/${n}`)}function Se({show:a,onHide:n,onSelect:r,filter:o=()=>!0,newFirst:x=!1}){const{t:y}=P(["page_character","sillyWisher_charNames","charNames_gen"]),{silly:p}=l.useContext(V),t=z(),[g,u]=l.useState(()=>t.displayCharacter.get());l.useEffect(()=>t.displayCharacter.follow((s,c)=>u(c)),[t,u]);const{gender:j}=F(),[v,C]=q();l.useEffect(()=>t.charMeta.followAny(()=>C()),[C,t]);const[h,T]=l.useState(""),D=l.useDeferredValue(h),M=l.useDeferredValue(g),S=l.useDeferredValue(v),f=l.useMemo(()=>{const{element:s,weaponType:c,sortType:d,ascending:L}=M,O=[...x?["new"]:[],...U[d]??[]];return S&&w.filter(E=>o(t.chars.get(E),b(E,j))).filter(J({element:s,weaponType:c,name:D},ge(t,p))).sort(K(O,L,je(t,p),["new","favorite"]))},[M,x,S,D,t,p,o,j]),N=l.useMemo(()=>k(Ce,s=>w.forEach(c=>{const d=b(c,t.gender).weaponTypeKey;s[d].total++,f.includes(c)&&s[d].current++})),[f,t]),A=l.useMemo(()=>k(be,s=>w.forEach(c=>{const d=b(c,t.gender).elementKey;s[d].total++,f.includes(c)&&s[d].current++})),[f,t]),{weaponType:G,element:$}=g;return e.jsx(Q,{open:a,onClose:n,sx:{"& .MuiContainer-root":{justifyContent:"normal"}},children:e.jsxs(R,{children:[e.jsxs(B,{sx:{py:1,display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:[e.jsx(X,{sx:{height:"100%"},onChange:s=>t.displayCharacter.set({weaponType:s}),value:G,totals:N,size:"small"}),e.jsx(Y,{sx:{height:"100%"},onChange:s=>t.displayCharacter.set({element:s}),value:$,totals:A,size:"small"}),e.jsx(i,{flexGrow:1,children:e.jsx(Z,{autoFocus:!0,value:h,onChange:s=>T(s.target.value),label:y("characterName"),size:"small",sx:{height:"100%"},InputProps:{sx:{height:"100%"}}})}),e.jsx(H,{onClick:n})]}),e.jsx(ee,{}),e.jsx(se.Provider,{value:{teamData:void 0},children:e.jsx(B,{children:e.jsx(I,{container:!0,spacing:1,columns:{xs:2,sm:3,md:4,lg:5},children:f.map(s=>e.jsx(I,{item:!0,xs:1,children:e.jsx(De,{characterKey:s,onClick:()=>{n(),r==null||r(s)}})},s))})})})]})})}const Te=ae(({className:a,...n})=>e.jsx(te,{...n,classes:{popper:a}}))({[`& .${ne.tooltip}`]:{padding:0}});function De({characterKey:a,onClick:n}){const{gender:r}=F(),o=b(a,r),x=oe(a),{favorite:y}=re(a)||{},p=z(),[t,g,u]=le(),{level:j=1,ascension:v=0,constellation:C=0}=x??{},h=ie(a,"banner",r);return e.jsx(Te,{enterDelay:300,enterNextDelay:300,arrow:!0,placement:"bottom",open:t,onClose:u,onOpen:g,title:e.jsx(i,{sx:{width:300},children:e.jsx(ce,{hideStats:!0,characterKey:a})}),children:e.jsx(i,{children:e.jsxs(de,{sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:[e.jsx(i,{sx:{position:"absolute",opacity:.7,zIndex:2},children:e.jsx(xe,{sx:{p:.25},onClick:T=>{u(),p.charMeta.set(a,{favorite:!y})},children:y?e.jsx(pe,{}):e.jsx(ue,{})})}),e.jsx(he,{onClick:n,children:e.jsxs(i,{display:"flex",position:"relative",className:h?void 0:`grad-${o==null?void 0:o.rarity}star`,sx:{"&::before":{content:'""',display:"block",position:"absolute",left:0,top:0,width:"100%",height:"100%",opacity:.7,backgroundImage:`url(${h})`,backgroundPosition:"center",backgroundSize:"cover"}},width:"100%",children:[e.jsx(i,{flexShrink:1,sx:{maxWidth:{xs:"33%",lg:"30%"}},alignSelf:"flex-end",display:"flex",flexDirection:"column",zIndex:1,children:e.jsx(i,{component:"img",src:fe(a,r),width:"100%",height:"auto",maxWidth:256,sx:{mt:"auto"}})}),e.jsxs(i,{flexGrow:1,sx:{pr:1,pt:1},display:"flex",flexDirection:"column",zIndex:1,justifyContent:"space-evenly",children:[e.jsx(m,{variant:"body2",sx:{flexGrow:1},children:e.jsx(W,{color:o==null?void 0:o.elementKey,sx:{opacity:.85,textShadow:"0 0 5px gray"},children:o==null?void 0:o.name})}),x?e.jsxs(i,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsxs(i,{sx:{textShadow:"0 0 5px gray"},children:[e.jsxs(m,{variant:"body2",component:"span",whiteSpace:"nowrap",children:["Lv. ",j]}),e.jsxs(m,{variant:"body2",component:"span",color:"text.secondary",children:["/",me[v]]})]}),e.jsxs(m,{variant:"body2",children:["C",C]})]}):e.jsx(m,{component:"span",variant:"body2",children:e.jsx(W,{children:"NEW"})}),e.jsx(ye,{stars:(o==null?void 0:o.rarity)??1,colored:!0})]})]})})]})})})}export{Se as default};
