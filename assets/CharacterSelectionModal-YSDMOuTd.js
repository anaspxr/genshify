import{o as $,u as P,r as l,S as V,a as F,b as I,c as q,d as K,e as T,g as C,f as U,s as J,j as e,M as R,C as Q,h as E,W as X,E as Y,B as i,T as Z,i as H,D as ee,k as se,G as B,l as te,m as ae,t as ne,n as oe,p as re,q as le,v as ie,w as ce,I as de,F as xe,x as pe,y as ue,z as he,A as f,H as W,J as fe,K as me,L as ye,N as je,O as ge,P as Ce}from"./index-9yedu4m5.js";function z(a,n){const r=we(a);return n(r),ve(r)}function we(a){return Object.fromEntries(a.map(n=>[n,{total:0,current:0}]))}function ve(a){return $(a,({total:n,current:r})=>r===n?`${n}`:`${r}/${n}`)}function Me({show:a,onHide:n,onSelect:r,filter:o=()=>!0,newFirst:x=!1}){const{t:m}=P(["page_character","sillyWisher_charNames","charNames_gen"]),{silly:p}=l.useContext(V),t=F(),[y,u]=l.useState(()=>t.displayCharacter.get());l.useEffect(()=>t.displayCharacter.follow((s,c)=>u(c)),[t,u]);const{gender:j}=I(),[w,g]=q();l.useEffect(()=>t.charMeta.followAny(()=>g()),[g,t]);const[v,k]=l.useState(""),b=l.useDeferredValue(v),D=l.useDeferredValue(y),M=l.useDeferredValue(w),h=l.useMemo(()=>{const{element:s,weaponType:c,sortType:d,ascending:O}=D,_=[...x?["new"]:[],...K[d]??[]];return M&&T.filter(S=>o(t.chars.get(S),C(S,j))).filter(U({element:s,weaponType:c,name:b},ye(t,p))).sort(J(_,O,je(t,p),["new","favorite"]))},[D,x,M,b,t,p,o,j]),N=l.useMemo(()=>z(ge,s=>T.forEach(c=>{const d=C(c,t.gender).weaponTypeKey;s[d].total++,h.includes(c)&&s[d].current++})),[h,t]),G=l.useMemo(()=>z(Ce,s=>T.forEach(c=>{const d=C(c,t.gender).elementKey;s[d].total++,h.includes(c)&&s[d].current++})),[h,t]),{weaponType:A,element:L}=y;return e.jsx(R,{open:a,onClose:n,sx:{"& .MuiContainer-root":{justifyContent:"normal"}},children:e.jsxs(Q,{children:[e.jsxs(E,{sx:{py:1,display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:[e.jsx(X,{sx:{height:"100%"},onChange:s=>t.displayCharacter.set({weaponType:s}),value:A,totals:N,size:"small"}),e.jsx(Y,{sx:{height:"100%"},onChange:s=>t.displayCharacter.set({element:s}),value:L,totals:G,size:"small"}),e.jsx(i,{flexGrow:1,children:e.jsx(Z,{autoFocus:!0,value:v,onChange:s=>k(s.target.value),label:m("characterName"),size:"small",sx:{height:"100%"},InputProps:{sx:{height:"100%"}}})}),e.jsx(H,{onClick:n})]}),e.jsx(ee,{}),e.jsx(se.Provider,{value:{teamData:void 0},children:e.jsx(E,{children:e.jsx(B,{container:!0,spacing:1,columns:{xs:2,sm:3,md:4,lg:5},children:h.map(s=>e.jsx(B,{item:!0,xs:1,children:e.jsx(be,{characterKey:s,onClick:()=>{n(),r==null||r(s)}})},s))})})})]})})}const Te=te(({className:a,...n})=>e.jsx(ae,{...n,classes:{popper:a}}))({[`& .${ne.tooltip}`]:{padding:0}});function be({characterKey:a,onClick:n}){const{gender:r}=I(),o=C(a,r),x=oe(a),{favorite:m}=re(a)||{},p=F(),[t,y,u]=le(),{level:j=1,ascension:w=0,constellation:g=0}=x??{};return e.jsx(Te,{enterDelay:300,enterNextDelay:300,arrow:!0,placement:"bottom",open:t,onClose:u,onOpen:y,title:e.jsx(i,{sx:{width:300},children:e.jsx(ie,{hideStats:!0,characterKey:a})}),children:e.jsx(i,{children:e.jsxs(ce,{sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:[e.jsx(i,{sx:{position:"absolute",opacity:.7,zIndex:2},children:e.jsx(de,{sx:{p:.25},onClick:v=>{u(),p.charMeta.set(a,{favorite:!m})},children:m?e.jsx(xe,{}):e.jsx(pe,{})})}),e.jsx(ue,{onClick:n,children:e.jsxs(i,{display:"flex",position:"relative",className:`grad-${o==null?void 0:o.rarity}star`,sx:{"&::before":{content:'""',display:"block",position:"absolute",left:0,top:0,width:"100%",height:"100%",opacity:.7,backgroundPosition:"center",backgroundSize:"cover"}},width:"100%",children:[e.jsx(i,{flexShrink:1,sx:{maxWidth:{xs:"33%",lg:"30%"}},alignSelf:"flex-end",display:"flex",flexDirection:"column",zIndex:1,children:e.jsx(i,{component:"img",src:he(a),width:"100%",height:"auto",maxWidth:256,sx:{mt:"auto"}})}),e.jsxs(i,{flexGrow:1,sx:{pr:1,pt:1},display:"flex",flexDirection:"column",zIndex:1,justifyContent:"space-evenly",children:[e.jsx(f,{variant:"body2",sx:{flexGrow:1},children:e.jsx(W,{color:o==null?void 0:o.elementKey,sx:{opacity:.85,textShadow:"0 0 5px gray"},children:o==null?void 0:o.name})}),x?e.jsxs(i,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsxs(i,{sx:{textShadow:"0 0 5px gray"},children:[e.jsxs(f,{variant:"body2",component:"span",whiteSpace:"nowrap",children:["Lv. ",j]}),e.jsxs(f,{variant:"body2",component:"span",color:"text.secondary",children:["/",fe[w]]})]}),e.jsxs(f,{variant:"body2",children:["C",g]})]}):e.jsx(f,{component:"span",variant:"body2",children:e.jsx(W,{children:"NEW"})}),e.jsx(me,{stars:(o==null?void 0:o.rarity)??1,colored:!0})]})]})})]})})})}export{Me as default};
